<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Teachers - LearniX</title>

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">

   <link rel="stylesheet" href="css/style.css">
   <style>
   /* Fix for Teacher Grid Layout */
   .teachers .box-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(30rem, 1fr));
      gap: 1.5rem;
      justify-content: center;
      align-items: flex-start;
   }

   .teachers .box-container .box {
      background-color: var(--white);
      border-radius: .5rem;
      padding: 2rem;
      border: var(--border); /* Ensure border variable exists */
      display: flex;
      flex-direction: column;
      gap: 1.5rem; /* Space between elements */
   }

   .teachers .box-container .offer {
      text-align: center;
      background-color: #333; /* Dark background for offer */
      color: #fff;
   }
   
   .teachers .box-container .offer h3 {
      font-size: 2.5rem;
      color: #fff;
      margin-bottom: 1rem;
   }

   .teachers .box-container .offer p {
      line-height: 1.8;
      color: #eee;
      margin-bottom: 2rem;
   }

   /* Teacher Card Specifics */
   .tutor {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 1rem;
   }

   .tutor img {
      height: 5rem;
      width: 5rem;
      border-radius: 50%;
      object-fit: cover;
   }

   .tutor h3 {
      font-size: 1.8rem;
      color: var(--black);
      margin-bottom: .2rem;
   }

   .tutor span {
      font-size: 1.3rem;
      color: var(--light-color);
   }

   .teachers .box p {
      font-size: 1.4rem;
      color: var(--light-color);
      overflow-wrap: break-word; /* Prevents long emails from breaking layout */
   }

   .teachers .box .inline-btn {
      margin-top: auto; /* Pushes button to bottom */
   }
</style>
</head>
<body>

<header class="header">
   <section class="flex">

      <a href="home.html" class="logo">LearniX</a>

      <form action="courses.html" method="get" class="search-form">
         <input type="text" name="search" required placeholder="search courses..." maxlength="100">
         <button type="submit" class="fas fa-search"></button>
      </form>

      <div class="icons">
         <div id="menu-btn" class="fas fa-bars"></div>
         <div id="search-btn" class="fas fa-search"></div>
         <div id="user-btn" class="fas fa-user"></div>
         <div id="toggle-btn" class="fas fa-sun"></div>
      </div>

      <div class="profile">
         <img src="images/pic-1.jpg" class="image" alt="">
         <h3 class="name">Guest</h3>
         <p class="role">Student</p>
         <a href="profile.html" class="btn">view profile</a>
         <div class="flex-btn">
            <a href="login.html" class="option-btn">login</a>
            <a href="register.html" class="option-btn">register</a>
         </div>
      </div>

   </section>
</header>

<div class="side-bar">

   <div id="close-btn">
      <i class="fas fa-times"></i>
   </div>

   <div class="profile">
      <img src="images/pic-1.jpg" class="image" alt="">
      
      <h3 class="name">Guest</h3>
      <p class="role">Student</p>

      <a href="profile.html" class="btn view-profile-btn" style="display: none;">view profile</a>

      <div class="flex-btn">
         <div class="guest-options">
            <a href="login.html" class="option-btn">login</a>
            <a href="register.html" class="option-btn">register</a>
         </div>

         <div class="user-options" style="display: none;">
            <button onclick="logout()" class="delete-btn">logout</button>
         </div>
      </div>
   </div>

   <nav class="navbar">
      <a href="home.html"><i class="fas fa-home"></i><span>home</span></a>
      <a href="dashboard.html"><i class="fas fa-chart-line"></i><span>dashboard</span></a>
      <a href="courses.html"><i class="fas fa-graduation-cap"></i><span>courses</span></a>
      <a href="teachers.html"><i class="fas fa-chalkboard-user"></i><span>teachers</span></a>
      <a href="forum.html"><i class="fas fa-comments"></i><span>forum</span></a>
      <a href="contact.html"><i class="fas fa-headset"></i><span>contact us</span></a>
   </nav>

</div>

<section class="teachers">

   <h1 class="heading">expert teachers</h1>

   <form action="#" class="search-tutor" id="teacherSearchForm">
      <input
         type="text"
         id="teacherSearchInput"
         placeholder="Search by name or role (e.g., Chakib, UI/UX, Web)..."
         maxlength="100"
         autocomplete="off"
      >
      <button type="submit" class="fas fa-search" aria-label="search"></button>
      <button type="button" class="fas fa-xmark" id="teacherSearchClear" aria-label="clear" title="Clear"></button>
   </form>

   <p id="teacherSearchMeta" style="margin:-0.5rem 0 2rem; font-size:1.45rem; opacity:.85;"></p>

   <div class="box-container" id="teacherGrid">

      <div class="box offer">
         <h3>become a tutor</h3>
         <p>Share your skills on LearniX, build your audience, and create structured playlists that help students learn faster.</p>
         <a href="register.html" class="inline-btn">get started</a>
      </div>

   </div>

</section>

<script src="js/script.js"></script>

<script>
   const input = document.getElementById('teacherSearchInput');
   const form = document.getElementById('teacherSearchForm');
   const clearBtn = document.getElementById('teacherSearchClear');
   const grid = document.getElementById('teacherGrid');
   const meta = document.getElementById('teacherSearchMeta');

   // âš ï¸ FIXED: Use your Tunnel URL (same as Dashboard)
   const API_BASE = 'https://wv7pc13r-5000.euw.devtunnels.ms';

   function getTeacherCards(){
      return Array.from(grid.querySelectorAll('.teacher-card'));
   }

   function updateMeta(visibleCount, total){
      if(!input.value.trim()){
         meta.textContent = `Showing ${total} tutors.`;
      }else{
         meta.textContent = `Results: ${visibleCount} / ${total}`;
      }
   }

   // 1. Fetch and Display Teachers
   // 1. Fetch and Display Teachers (Corrected URL)
   async function loadTeachers() {
      // âš ï¸ IMPORTANT: Use your Tunnel URL (same as Dashboard)
      const API_BASE = 'https://wv7pc13r-5000.euw.devtunnels.ms'; 

      try {
         // âœ… FIXED: Added '/api' prefix to match server routes
         const res = await fetch(`${API_BASE}/api/enseignant`);
         
         if(!res.ok) throw new Error(`HTTP Error: ${res.status}`);
         
         const teachers = await res.json();
         
         const offerBox = grid.querySelector('.offer');
         grid.innerHTML = '';
         if(offerBox) grid.appendChild(offerBox);

         if (!Array.isArray(teachers) || teachers.length === 0) {
            meta.textContent = 'No teachers found.';
            return;
         }

         teachers.forEach(teacher => {
            const card = document.createElement('div');
            card.className = 'box teacher-card animate-scale';
            card.dataset.name = `${teacher.nom} ${teacher.prenom}`;
            card.dataset.role = teacher.role || 'Teacher';

            // Safe Image Logic
            let safeImagePath = teacher.image ? teacher.image.replace(/\\/g, '/') : 'images/pic-2.jpg';
            let teacherImg = safeImagePath.startsWith('http') ? safeImagePath : `${API_BASE}/${safeImagePath}`;

            card.innerHTML = `
               <div class="tutor">
                  <img src="${teacherImg}" alt="${teacher.nom}" onerror="this.src='images/pic-2.jpg'">
                  <div>
                     <h3>${teacher.prenom || ''} ${teacher.nom || 'User'}</h3>
                     <span>${teacher.role || 'Teacher'}</span>
                  </div>
               </div>
               <p>Email: <span style="text-transform:none;">${teacher.email}</span></p>
               <a href="teacher_profile.html?id=${teacher._id}" class="inline-btn">view profile</a>
            `;
            grid.appendChild(card);
         });

         filterTeachers();
      } catch (err) {
         console.error("Failed to load teachers:", err);
         meta.textContent = 'Error loading teachers. Check console.';
      }
   }
  function filterTeachers(){
      // Get input value safely
      const inputVal = input.value || ''; 
      const q = inputVal.trim().toLowerCase();
      
      const cards = getTeacherCards();
      const total = cards.length;
      let visible = 0;

      cards.forEach(card => {
         // ðŸ›¡ï¸ CRASH PROTECTION
         const name = (card.dataset.name || '').toLowerCase();
         const role = (card.dataset.role || '').toLowerCase();
         const text = (card.textContent || '').toLowerCase(); // Fallback to visible text

         // Logic: If query is empty OR matches name OR matches role
         const match = !q || name.includes(q) || role.includes(q) || text.includes(q);

         card.style.display = match ? 'flex' : 'none'; // Use 'flex' to keep layout
         if(match) visible++;
      });

      updateMeta(visible, total);
   }
   // Prevent reload on submit
   form.addEventListener('submit', (e) => {
      e.preventDefault();
      filterTeachers();
   });

   // Live search
   input.addEventListener('input', filterTeachers);

   // Clear
   clearBtn.addEventListener('click', () => {
      input.value = '';
      input.focus();
      filterTeachers();
   });

   // Init
   loadTeachers();
</script>

</body>
</html>