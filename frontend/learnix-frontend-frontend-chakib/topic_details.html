<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Détails Sujet</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">
   <link rel="stylesheet" href="css/style.css">
</head>
<body>

<section class="watch-video"> <div class="video-container" id="mainTopic">
      </div>

   <h1 class="heading">Réponses</h1>

   <div class="box-container" id="repliesList">
      </div>

   <div class="box-container" style="margin-top:2rem">
      <div class="box" style="width:100%">
         <h3>Votre réponse</h3>
         <form id="replyForm">
            <textarea id="replyContent" class="box" style="width:100%; height:100px" required></textarea>
            <button type="submit" class="inline-btn">Répondre</button>
         </form>
      </div>
   </div>

</section>

<script src="js/script.js"></script>
<script>
   const API_BASE = 'http://localhost:5000';
   const urlParams = new URLSearchParams(window.location.search);
   const topicId = urlParams.get('id');

   async function loadTopic() {
      const res = await fetch(`${API_BASE}/api/forum/${topicId}`);
      const topic = await res.json();
      
      // Afficher le sujet principal
      document.getElementById('mainTopic').innerHTML = `
         <div class="video">
            <h3 class="title" style="font-size: 2.5rem; margin-bottom: 1rem;">${topic.titre}</h3>
            <div class="info">
               <p class="date"><i class="fas fa-calendar"></i><span>${new Date(topic.createdAt).toLocaleDateString()}</span></p>
            </div>
            <div class="tutor">
               <img src="${topic.auteur.image ? API_BASE+'/'+topic.auteur.image : 'images/pic-1.jpg'}" alt="">
               <div>
                  <h3>${topic.auteur.nom} ${topic.auteur.prenom}</h3>
                  <span>Auteur</span>
               </div>
            </div>
            <div class="description" style="font-size: 1.6rem; padding: 2rem; background: var(--white); border-radius: .5rem; margin-top: 1rem;">
               ${topic.contenu}
            </div>
         </div>
      `;

      // Afficher les réponses
      document.getElementById('repliesList').innerHTML = topic.reponses.map(rep => `
         <div class="box" style="width:100%; display:flex; gap:1.5rem; align-items:flex-start;">
            <img src="${rep.auteur.image ? API_BASE+'/'+rep.auteur.image : 'images/pic-1.jpg'}" 
                 style="height: 5rem; width: 5rem; borderRadius: 50%; objectFit: cover;">
            <div>
               <h3 style="font-size: 1.6rem; color: var(--black);">${rep.auteur.nom} ${rep.auteur.prenom}</h3>
               <span style="font-size: 1.3rem; color: var(--light-color);">${new Date(rep.date).toLocaleDateString()}</span>
               <p style="font-size: 1.5rem; color: var(--light-color); margin-top: .5rem;">${rep.contenu}</p>
            </div>
         </div>
      `).join('');
   }

   // Ajouter une réponse
   document.getElementById('replyForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const token = localStorage.getItem('token');
      const contenu = document.getElementById('replyContent').value;

      await fetch(`${API_BASE}/api/forum/${topicId}/reply`, {
         method: 'POST',
         headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
         body: JSON.stringify({ contenu })
      });
      window.location.reload();
   });

   loadTopic();
</script>
</body>
</html>