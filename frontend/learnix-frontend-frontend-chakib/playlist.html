<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Course Playlist</title>

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">
   <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="header">
   <section class="flex">
      <a href="home.html" class="logo">LearniX</a>
      <form action="courses.html" method="get" class="search-form">
         <input type="text" name="search" required placeholder="search courses..." maxlength="100">
         <button type="submit" class="fas fa-search"></button>
      </form>
      <div class="icons">
         <div id="menu-btn" class="fas fa-bars"></div>
         <div id="search-btn" class="fas fa-search"></div>
         <div id="user-btn" class="fas fa-user"></div>
         <div id="toggle-btn" class="fas fa-sun"></div>
      </div>
      <div class="profile">
         <img src="images/pic-1.jpg" class="image" alt="">
         <h3 class="name">User</h3>
         <p class="role">Student</p>
         <a href="profile.html" class="btn">view profile</a>
      </div>
   </section>
</header>

<div class="side-bar">
   <div id="close-btn"><i class="fas fa-times"></i></div>
   <div class="profile">
      <img src="images/pic-1.jpg" class="image" alt="">
      <h3 class="name">User</h3>
      <p class="role">Student</p>
      <a href="profile.html" class="btn">view profile</a>
   </div>
   <nav class="navbar">
      <a href="home.html"><i class="fas fa-home"></i><span>home</span></a>
      <a href="dashboard.html"><i class="fas fa-chart-line"></i><span>dashboard</span></a>
      <a href="about.html"><i class="fas fa-question"></i><span>about</span></a>
      <a href="courses.html"><i class="fas fa-graduation-cap"></i><span>courses</span></a>
      <a href="teachers.html"><i class="fas fa-chalkboard-user"></i><span>teachers</span></a>
      <a href="forum.html"><i class="fas fa-comments"></i><span>forum</span></a>
      <a href="contact.html"><i class="fas fa-headset"></i><span>contact us</span></a>
   </nav>
</div>

<section class="playlist-details">

   <h1 class="heading">Course Details</h1>

   <div class="row">
      <div class="column">
         <div class="save-playlist">
            <button onclick="savePlaylist()" class="far fa-bookmark" id="saveBtn"></button>
            <span id="saveText">save playlist</span>
         </div>
   
         <div class="thumb">
            <img id="courseImage" src="images/thumb-1.png" alt="">
            <span id="courseCount">0 videos</span>
         </div>
      </div>
      <div class="column">
         <div class="tutor">
            <img id="tutorImage" src="images/pic-2.jpg" alt="">
            <div>
               <h3 id="tutorName">Teacher Name</h3>
               <span id="tutorSpecialty">Specialty</span>
            </div>
         </div>
   
         <div class="details">
            <h3 id="courseTitle">Loading title...</h3>
            <p id="courseDesc">Loading description...</p>
            <a href="profile.html" class="inline-btn">view profile</a>
         </div>
      </div>
   </div>

</section>

<section class="playlist-videos">
   <h1 class="heading">Playlist Videos</h1>
   <div class="box-container" id="videoContainer">
      <p style="text-align: center; width: 100%;">Loading videos...</p>
   </div>
</section>

<section class="playlist-videos">
   <h1 class="heading">Course Quizzes</h1>
   <div class="box-container" id="quizContainer">
      <p style="text-align: center; width: 100%;">Checking for quizzes...</p>
   </div>
</section>
<script src="js/script.js"></script>
<script>
   // ⚠️ IMPORTANT : Mets l'URL de ton backend ici
   const API_BASE = 'http://localhost:5000'; 
  
   document.addEventListener('DOMContentLoaded', async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const courseId = urlParams.get('id');

      if (!courseId) {
         alert("No course ID provided!");
         window.location.href = 'courses.html';
         return;
      }

      try {
         // 1. Récupérer les détails du cours
         const res = await fetch(`${API_BASE}/api/cours/${courseId}`);
         if (!res.ok) throw new Error("Course not found");
         
         const course = await res.json();

         // 2. Remplir les infos du cours
         document.getElementById('courseTitle').textContent = course.titre;
         document.getElementById('courseDesc').textContent = course.description;
         
         // Image du cours
         const imgUrl = course.image ? (course.image.startsWith('http') ? course.image : `${API_BASE}/${course.image}`) : 'images/thumb-1.png';
         document.getElementById('courseImage').src = imgUrl;

         // Infos du Prof
         if (course.enseignant) {
             document.getElementById('tutorName').textContent = `${course.enseignant.nom} ${course.enseignant.prenom}`;
             const profImg = course.enseignant.image ? (course.enseignant.image.startsWith('http') ? course.enseignant.image : `${API_BASE}/${course.enseignant.image}`) : 'images/pic-2.jpg';
             document.getElementById('tutorImage').src = profImg;
         }

         // 3. AFFICHER LES VIDÉOS (C'est ici que la magie opère !)
         const videoContainer = document.getElementById('videoContainer');
         videoContainer.innerHTML = ''; // On vide le "Chargement..."

         const videos = course.contenu || [];
         document.getElementById('courseCount').textContent = `${videos.length} videos`;

         if (videos.length === 0) {
            videoContainer.innerHTML = '<p class="empty">No videos uploaded yet!</p>';
         } else {
            videos.forEach((video, index) => {
               // Construire l'URL de la vidéo
               // Le backend renvoie souvent "uploads/videos/..." donc on ajoute API_BASE devant
               const videoUrl = video.url.startsWith('http') ? video.url : `${API_BASE}/${video.url}`;
               
               const box = document.createElement('div');
               box.className = 'box';
               box.innerHTML = `
                  <i class="fas fa-play"></i>
                  <img src="${imgUrl}" alt=""> <h3>${video.titre || 'Video ' + (index + 1)}</h3>
                  <a href="watch-video.html?courseId=${course._id}&videoId=${video._id || index}" class="inline-btn">Watch Video</a>
               `;
               videoContainer.appendChild(box);
            });
         }

      } catch (err) {
         console.error(err);
         document.getElementById('videoContainer').innerHTML = '<p class="empty">Error loading course details.</p>';
      }
   });

   function savePlaylist() {
      // Tu pourras ajouter la logique de favoris ici plus tard
      const btn = document.getElementById('saveBtn');
      if(btn.classList.contains('far')) {
         btn.classList.replace('far', 'fas');
         document.getElementById('saveText').textContent = 'saved';
         alert("Playlist saved!");
      } else {
         btn.classList.replace('fas', 'far');
         document.getElementById('saveText').textContent = 'save playlist';
      }
   }
</script>

</body>
</html>