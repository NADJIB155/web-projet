<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Home - LearniX</title>

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">
   <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="header">
   <section class="flex">
      <a href="home.html" class="logo">LearniX</a>
      <form action="courses.html" method="get" class="search-form">
         <input type="text" name="search" required placeholder="search courses..." maxlength="100">
         <button type="submit" class="fas fa-search"></button>
      </form>
      <div class="icons">
         <div id="menu-btn" class="fas fa-bars"></div>
         <div id="search-btn" class="fas fa-search"></div>
         <div id="user-btn" class="fas fa-user"></div>
         <div id="toggle-btn" class="fas fa-sun"></div>
      </div>

      <div class="profile">
         <img src="images/pic-1.jpg" class="image" alt="">
         <h3 class="name">Guest</h3>
         <p class="role">Student</p>
         
         <div class="logged-in-btns" style="display: none;">
            <a href="profile.html" class="btn">view profile</a>
            <div class="flex-btn">
               <button onclick="logout()" class="delete-btn">logout</button>
            </div>
         </div>

         <div class="guest-btns" style="display: flex;">
            <a href="login.html" class="option-btn">login</a>
            <a href="register.html" class="option-btn">register</a>
         </div>
      </div>
   </section>
</header>   

<div class="side-bar">
   <div id="close-btn"><i class="fas fa-times"></i></div>
   
   <div class="profile">
      <img src="images/pic-1.jpg" class="image" alt="">
      <h3 class="name">Guest</h3>
      <p class="role">Student</p>
      
      <div class="logged-in-btns" style="display: none;">
         <a href="profile.html" class="btn">view profile</a>
         <div class="flex-btn">
            <button onclick="logout()" class="delete-btn">logout</button>
         </div>
      </div>

      <div class="guest-btns" style="display: flex;">
         <a href="login.html" class="option-btn">login</a>
         <a href="register.html" class="option-btn">register</a>
      </div>
   </div>

   <nav class="navbar">
      <a href="home.html"><i class="fas fa-home"></i><span>home</span></a>
      <a href="dashboard.html"><i class="fas fa-chart-line"></i><span>dashboard</span></a>
      <a href="courses.html"><i class="fas fa-graduation-cap"></i><span>courses</span></a>
      <a href="teachers.html"><i class="fas fa-chalkboard-user"></i><span>teachers</span></a>
      <a href="forum.html"><i class="fas fa-comments"></i><span>forum</span></a>
      <a href="contact.html"><i class="fas fa-headset"></i><span>contact us</span></a>
   </nav>
</div>

<section class="home-grid">

   <div class="box" style="background: linear-gradient(135deg, #0D0F2E 0%, #1e2252 100%); color: white; text-align: center;">
      <h3 class="title" id="welcome-title" style="color: white; font-size: 2.5rem; margin-bottom: 1rem;">Welcome back!</h3>
      <p class="description" id="welcome-text" style="color: #ddd; font-size: 1.6rem; line-height: 1.5; margin-bottom: 2rem;">
         Learn with curated courses, track your progress, and get support from expert tutors.
      </p>
      
      <div id="student-btns" class="flex-btn" style="gap: 1rem; justify-content: center;">
          <a href="courses.html" class="inline-btn" style="background-color: var(--main-color);">Explore Courses</a>
          <a href="contact.html" class="inline-btn" style="background-color: transparent; border: 2px solid var(--main-color); color: white;">Contact Us</a>
      </div>

      <div id="teacher-btns" class="flex-btn" style="gap: 1rem; display: none; justify-content: center;">
          <a href="dashboard.html" class="inline-btn" style="background-color: var(--main-color);">Dashboard</a>
          <a href="dashboard.html" class="inline-btn" style="background-color: transparent; border: 2px solid var(--main-color); color: white;">Analytics</a>
      </div>
   </div>

   <div class="box" 
        style="
           background: linear-gradient(145deg, #1a1d3a, #23274a); 
           border-radius: 2rem; 
           border: 1px solid rgba(255,255,255,0.1); 
           box-shadow: 0 1.5rem 3.5rem rgba(0,0,0,0.2); 
           position: relative; 
           overflow: hidden; 
           transition: transform 0.3s ease;
           text-align: center; /* Tout centrer */
        "
        onmouseover="this.style.transform='translateY(-5px)'"
        onmouseout="this.style.transform='translateY(0px)'"
   >
      <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: #8e44ad; filter: blur(80px); opacity: 0.4;"></div>

      <div id="student-hero">
          <h3 class="title" style="color: white; font-size: 2.2rem; font-weight: 700; margin-bottom: 2rem;">Start Learning</h3>
          
          <div class="flex" style="flex-direction: column; align-items: center; gap: 1.5rem; margin-bottom: 2.5rem;">
             <div style="width: 7rem; height: 7rem; background: rgba(255, 165, 0, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(255, 165, 0, 0.2);">
                <i class="fas fa-rocket" style="font-size: 3.5rem; color: #ff9f43;"></i>
             </div>
             <div>
                <span style="font-size: 1.8rem; color: white; font-weight: 600; display: block; margin-bottom: 0.5rem;">Explore Catalog</span>
                <p style="font-size: 1.4rem; color: #a4b0be;">Unlock new skills today</p>
             </div>
          </div>
          
          <a href="courses.html" class="inline-btn" style="background: linear-gradient(90deg, #ff9f43, #ff6b6b); color: white; width: 100%; text-align: center; border-radius: 1rem; box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3); border: none;">View All Courses</a>
      </div>

      <div id="teacher-hero" style="display: none;">
          <div style="margin-bottom: 1.5rem;">
             <h3 class="title" style="color: white; font-size: 2.2rem; font-weight: 700; margin-bottom: 0.5rem;">Quick Action</h3>
             <span style="background: rgba(142, 68, 173, 0.2); color: #a29bfe; padding: 0.3rem 1rem; border-radius: 2rem; font-size: 1.2rem;">Teacher Mode</span>
          </div>

          <div class="flex" style="flex-direction: column; align-items: center; gap: 1.5rem; margin-bottom: 2.5rem;">
             <div style="width: 7rem; height: 7rem; background: linear-gradient(135deg, #6c5ce7, #8e44ad); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 25px rgba(142, 68, 173, 0.4); border: 1px solid rgba(255,255,255,0.1);">
                <i class="fas fa-plus" style="font-size: 3rem; color: white;"></i>
             </div>
             <div>
                <span style="font-size: 1.8rem; color: white; font-weight: 600; display: block; margin-bottom: 0.5rem;">New Content?</span>
                <p style="font-size: 1.4rem; color: #a4b0be;">Share your knowledge</p>
             </div>
          </div>
          
          <a href="dashboard.html" class="inline-btn" style="background: linear-gradient(90deg, #8e44ad, #6c5ce7); color: white; width: 100%; text-align: center; border-radius: 1.2rem; font-weight: 600; letter-spacing: 0.5px; box-shadow: 0 8px 20px rgba(108, 92, 231, 0.3); border: none; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'"><i class="fas fa-layer-group" style="margin-right: 0.5rem;"></i> Create New Course</a>
      </div>
   </div>

</section>

<section class="courses">
   <h1 class="heading">our courses</h1>
   <div class="box-container" id="coursesGrid">
      <p class="empty">Loading courses...</p>
   </div>
   <div class="more-btn">
      <a href="courses.html" class="inline-option-btn">view all courses</a>
   </div>
</section>

<footer class="footer">
   &copy; copyright @ 2026 by <span>LearniX</span> | all rights reserved!
</footer>

<script src="js/script.js"></script>
<script>
   const API_BASE = 'https://wv7pc13r-5000.euw.devtunnels.ms'; 

   function logout() {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      alert("You have been logged out.");
      window.location.href = 'home.html';
   }

   document.addEventListener('DOMContentLoaded', async () => {
      const user = getCurrentUser(); 

      // 1. GESTION AFFICHAGE PROFIL & LOGOUT
      if (user) {
         document.querySelectorAll('.name').forEach(el => el.textContent = `${user.prenom || ''} ${user.nom || ''}`);
         document.querySelectorAll('.role').forEach(el => el.textContent = user.role);
         
         document.querySelectorAll('.logged-in-btns').forEach(el => el.style.display = 'block');
         document.querySelectorAll('.guest-btns').forEach(el => el.style.display = 'none');

         // 2. ADAPTATION DU BANDEAU
         document.getElementById('welcome-title').textContent = `Welcome back, ${user.prenom || 'User'}!`;
         
         const isTeacher = (user.role === 'enseignant' || user.role === 'teacher');
         
         if (isTeacher) {
             document.getElementById('welcome-text').textContent = "Manage your courses, track student progress, and create inspiring content.";
             document.getElementById('student-btns').style.display = 'none';
             document.getElementById('teacher-btns').style.display = 'flex';
             document.getElementById('student-hero').style.display = 'none';
             document.getElementById('teacher-hero').style.display = 'block';
         }

      } else {
         document.querySelectorAll('.logged-in-btns').forEach(el => el.style.display = 'none');
         document.querySelectorAll('.guest-btns').forEach(el => el.style.display = 'flex');
      }

      // 3. CHARGEMENT DES COURS
      try {
         const res = await fetch(`${API_BASE}/api/cours`);
         const courses = await res.json();
         const grid = document.getElementById('coursesGrid');
         
         if(grid) {
             grid.innerHTML = '';
             const previewCourses = courses.slice(0, 3);
             
             if(previewCourses.length === 0) {
                 grid.innerHTML = '<p class="empty">No courses added yet!</p>';
             } else {
                 previewCourses.forEach(course => {
                    let imgUrl = course.image ? (course.image.startsWith('http') ? course.image : `${API_BASE}/${course.image}`) : 'images/thumb-1.png';
                    const box = document.createElement('div');
                    box.className = 'box';
                    box.innerHTML = `
                       <div class="thumb">
                          <img src="${imgUrl}" alt="">
                          <span>${course.specialite || 'General'}</span>
                       </div>
                       <h3 class="title">${course.titre}</h3>
                       <a href="playlist.html?id=${course._id}" class="inline-btn">view playlist</a>
                    `;
                    grid.appendChild(box);
                 });
             }
         }
      } catch(err) {
         console.error(err);
      }
   });
</script>

</body>
</html>