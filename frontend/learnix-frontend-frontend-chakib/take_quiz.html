<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Passer le Quiz - LearniX</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">
   <link rel="stylesheet" href="css/style.css">
</head>
<body>

<header class="header">
   <section class="flex">
      <a href="home.html" class="logo">LearniX</a>
      <div class="icons">
         <a href="home.html"><div class="fas fa-home"></div></a>
         <div id="user-btn" class="fas fa-user"></div>
      </div>
   </section>
</header>

<section class="form-container">
   <form id="quizForm" style="max-width: 800px; width:100%">
      <h3 id="quizTitle" class="heading">Chargement du Quiz...</h3>
      
      <div id="questionsList"></div>

      <input type="submit" value="Valider mes rÃ©ponses" class="btn" name="submit">
      
      <div id="resultBox" style="display:none; text-align:center; margin-top:2rem;">
         <p id="scoreText" style="font-size: 2.5rem; color: var(--black); font-weight:bold;"></p>
         <p id="messageText" style="font-size: 1.6rem; margin:1rem 0;"></p>
         <a href="courses.html" class="inline-btn">Retour aux cours</a>
      </div>
   </form>
</section>

<script src="js/script.js"></script>
<script src="js/script.js"></script>
<script>
   // âš ï¸ Votre URL Tunnel
   const API_BASE = 'https://wv7pc13r-5000.euw.devtunnels.ms'; 
   
   const urlParams = new URLSearchParams(window.location.search);
   const quizId = urlParams.get('id');
   let currentQuiz = null;

   // 1. CHARGER LE QUIZ
   async function loadQuiz() {
       try {
           if(!quizId) throw new Error("ID manquant");
           
           const token = localStorage.getItem('token');
           
           const response = await fetch(`${API_BASE}/api/quizzes/detail/${quizId}`, {
               headers: { 'Authorization': `Bearer ${token}` }
           });

           if(!response.ok) throw new Error("Erreur chargement (VÃ©rifiez que vous Ãªtes connectÃ©)");
           
           currentQuiz = await response.json();
           document.getElementById('quizTitle').textContent = currentQuiz.titre;

           const container = document.getElementById('questionsList');
           container.innerHTML = '';
           
           currentQuiz.questions.forEach((q, index) => {
               const qDiv = document.createElement('div');
               qDiv.className = 'box';
               qDiv.style.textAlign = 'left';
               qDiv.style.marginBottom = '1.5rem';

               let optionsHTML = '';
               q.options.forEach((opt, optIndex) => {
                   optionsHTML += `
                       <div class="flex" style="gap:1rem; margin-top:1rem; align-items:center;">
                           <input type="radio" name="q_${index}" value="${optIndex}" id="q${index}_o${optIndex}" style="width:20px; height:20px; cursor:pointer;">
                           <label for="q${index}_o${optIndex}" style="font-size:1.6rem; cursor:pointer; width:100%">${opt}</label>
                       </div>
                   `;
               });

               qDiv.innerHTML = `
                   <p style="font-size: 1.8rem; font-weight:bold; color: var(--black);">
                       ${index + 1}. ${q.questionText}
                   </p>
                   ${optionsHTML}
               `;
               container.appendChild(qDiv);
           });

       } catch(e) {
           console.error(e);
           document.getElementById('quizTitle').textContent = "Impossible de charger le quiz.";
       }
   }

   // 2. SOUMETTRE ET CALCULER LE SCORE
   document.getElementById('quizForm').onsubmit = (e) => {
       e.preventDefault();
       if(!currentQuiz) return;

       let score = 0;
       let total = currentQuiz.questions.length;

       currentQuiz.questions.forEach((q, index) => {
           const selected = document.querySelector(`input[name="q_${index}"]:checked`);
           
           if (selected) {
               // Comparaison souple (==) pour gÃ©rer string/number sans bug
               if(selected.value == q.correctAnswer) {
                   score++;
               }
           }
       });

       const scoreText = document.getElementById('scoreText');
       const msgText = document.getElementById('messageText');
       const resultBox = document.getElementById('resultBox');

       scoreText.textContent = `Note : ${score} / ${total}`;
       
       if((score/total) >= 0.5) {
           scoreText.style.color = 'green';
           msgText.textContent = "Bravo ! Vous avez rÃ©ussi. ðŸŽ‰";
       } else {
           scoreText.style.color = 'red';
           msgText.textContent = "Courage, rÃ©essayez ! ðŸ’ª";
       }

       document.querySelector('input[type="submit"]').style.display = 'none';
       resultBox.style.display = 'block';
   };

   loadQuiz();
</script>
</body>
</html>